<project name="org.thechiselgroup.choosel" 
         default="choosel-dist" basedir=".">

  <property name="choosel-version" value="0.0" />
  	
  <property name="dist" location="bin/dist"/>
  <property name="src" location="src"/>
  <property name="class-dir" location="war/WEB-INF/classes"/>
  <property name="lib" location="lib"/>
  <property name="app-lib" value="bin/build/lib"/>
	
  <typedef resource="org/tigris/subversion/svnant/svnantlib.xml" classpath="svnant.jar" /> 
 
  <!-- tasks that are called from external application ant buildfiles -->
	
  <target name="application-prepare"
  	      description="prepares folders in application"
  	      depends="application-clean">
  	 
    <mkdir dir="${app-dir}/${app-lib}"/>
  </target>
	
  <target name="application-clean" 
          description="clean automatically created resources in application project">
    
    <delete dir="${app-dir}/${app-lib}"/>
  </target>
	
  <target name="application-import-libs"
  	      description="imports libraries from choosel into application project"
  	      depends="application-prepare,choosel-dist">
  	 
    <copy todir="${app-dir}/${app-lib}">
      <fileset dir="${dist}"/>
    </copy>
  </target>
	
  <!-- choosel framework tasks -->
	
  <target name="choosel-dist" 
	      description="creates choosel distribution"
  	      depends="choosel-create-module-jar, choosel-copy-libs-to-dist">
  </target>
	
  <target name="choosel-create-module-jar"
  	      description="creates the module jar file for choosel"
  	      depends="choosel-prepare">
  	
    <jar destfile="${dist}/choosel-${choosel-version}.jar">
      <fileset dir="${src}" />
      <fileset dir="${class-dir}" /> 
    </jar>
  </target>
	
  <target name="choosel-copy-libs-to-dist" 
	      description="copies the requried libraries to the dist directory"
          depends="choosel-prepare" >
  	
    <copy todir="${dist}">
      <fileset dir="${lib}"/>
    </copy>
  </target>
	
  <target name="choosel-clean" 
          description="clean automatically created resources in choosel project">
  	
  	<delete dir="${dist}"/>
  </target>
	
  <target name="choosel-prepare"
  	      description="create folders required for choosel build"
          depends="choosel-clean">
  	
    <mkdir dir="${dist}"/>
  </target>
	
  <target name="choosel-javadoc"
	     description="updates the javadocs">
  	
	  <path id="javadoc-lib">
		<fileset dir="lib/">
		  <include name="*.jar" />
		</fileset>
		<fileset dir="build/antlib/">
		  <include name="*.jar" />
		</fileset>
   	  </path>
  	
	  <delete dir="docs/api"/>
  	  <mkdir dir="docs/api"/>
	  <javadoc
	           destdir="docs/api"
	  		   classpathref="javadoc-lib"
	           author="true"
	           version="false"
	           use="true"
	           windowtitle="Choosel API"
	  		   private="true">

	  	<!-- 
	  	  TODO check this - including the server causes problems because the classpath does
	  	  not contain the required annotation classes
	  	-->
	    <packageset dir="src" defaultexcludes="yes">
	      <include name="org/thechiselgroup/choosel/client/**"/>
	    </packageset>

	    <doctitle><![CDATA[<h1>Choosel API Documentation</h1>]]></doctitle>
	    <bottom><![CDATA[(C) <a href="http://code.google.com/p/choosel/">Choosel Project</a> 2010]]></bottom>
	    <link href="http://download.oracle.com/javase/6/docs/api/"/>
	    <link href="http://google-web-toolkit.googlecode.com/svn/javadoc/2.0/index.html"/>
	  </javadoc>
  </target>
  	
  <!--
    Checks out gwt-dnd-3.0.0 and applies performance and null pointer exception patch.
  -->
  <target name="dnd-library">
  	<delete dir="bin/temp/gwt-dnd"/>
  	<delete dir="bin/temp/gwt-dnd-classes"/>
  	
  	<mkdir dir="bin/temp/gwt-dnd"/>
  	<mkdir dir="bin/temp/gwt-dnd-classes"/>
  	
  	<svn javahl="false" svnkit="true">
  	  <checkout url="http://gwt-dnd.googlecode.com/svn/tags/gwt-dnd-3.0.0-r997/DragDrop" 
  	  	        destPath="bin/temp/gwt-dnd" />
  	</svn>
  	
  	<!-- 
  	  Windows Installation: Use http://gnuwin32.sourceforge.net/packages/patch.htm 
  	  Windows Vista / 7: Full GnuWin32 Installation required
  	    see http://sourceforge.net/tracker/index.php?func=detail&aid=1890860&group_id=23617&atid=379173
  	-->
  	<!--
  	  NOTE: patch order important
  	-->
  	<patch patchfile="build/patches/MouseDragHandler.java-Performance.patch"
  	       originalfile="bin/temp/gwt-dnd/src/com/allen_sauer/gwt/dnd/client/MouseDragHandler.java" />
  	<patch patchfile="build/patches/MouseDragHandler.java-NullPointerException.patch"
  	       originalfile="bin/temp/gwt-dnd/src/com/allen_sauer/gwt/dnd/client/MouseDragHandler.java" />
  	
  	<javac srcdir="bin/temp/gwt-dnd/src"
  	       destdir="bin/temp/gwt-dnd-classes" />
  	
    <jar destfile="bin/temp/gwt-dnd-3.0.0-patched.jar">
      <fileset dir="bin/temp/gwt-dnd/src" />
      <fileset dir="bin/temp/gwt-dnd-classes"/>
    </jar>
  	
  	<copy file="bin/temp/gwt-dnd-3.0.0-patched.jar" todir="lib"/>
  	
  </target>

</project>